<html>
  <head>
    <title>{{if .CurrentChannel}}{{ .CurrentChannel }}{{else}}-{{end}} :: {{.User}} :: teve</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="{{.BaseUrl}}static/pure-min.css">
    <link rel="stylesheet" href="{{.BaseUrl}}static/styles.css">
    <meta http-equiv="refresh" content="180; url={{.BaseUrl}}">
    <meta name="viewport" content="width=device-width, user-scalable=no">
  </head>
  <body>
  {{$base := .BaseUrl}}
  <div class="home-menu pure-menu pure-menu-open pure-menu-fixed pure-menu-horizontal">
    <a class="pure-menu-heading" href="{{$base}}">teve</a>
    <ul>
      {{if .Running}}
      <li><span>Spiller <b>{{.CurrentChannel}}</b></span></li>
      <li><a href="{{$base}}?kchannel=1" class="pure-button button-red">Stopp</a></li>
      <li><a href="#" class="pure-button button-lblue">{{.Viewers}} seere</a></li>
      {{end}}
      <li><a class="pure-button button-green" href="{{$base}}archive">Gå til arkiv</a></li>
      <li><span>Velkommen {{.User}}!</span></li>
    </ul>
  </div>
  <div class="clear"></div>
  <div class="content">
      {{if .Running }}
        <div class="bs-callout bs-callout-danger">
          <h4>Play in VLC?</h4>
          <p>Din URL er: <a href="{{.URL}}"><em>{{.URL}}</em></a></p>
          <p><a href="{{$base}}vlc?url={{.URL}}" target="_blank">Trykk her</a> for å spille i nettleseren din (Du behøver en <a href="http://www.videolan.org/vlc/#download">VLC-plugin</a> og lenken blir åpnet i ny tab/vindu)</p>
          </p>
        </div>
        <form action="{{$base}}" method="get" class="pure-form">
          <h2 class="underlined">Transkoding</h2>
          <p>Transkoding i <b>kbit/s</b>, dvs. lavere tall gir dårligere kvalitet. Transkodet med <b>mp2v</b> og skalert med faktor på <b>0.7</b>.
             0 kbit/s er det samme som ingen transkoding.</p>
          <div class="pure-g">
            <div class="pure-u-1-2">
              <input type="hidden" name="channel" value="{{.CurrentChannel}}">
              <input type="hidden" name="refresh" value="1">
              <input type="text" id="transcoding" class="pure-input-1" name="transcoding" value="{{.Transcoding}}">
            </div>
            <div class="pure-u-1-2">
              <input type="submit" class="pure-button button-yellow set-button" value="Lagre"></input>
            </div>
          </div>
        </form>
      {{end}}
    </p>
    <form action="./external" method="get" class="pure-form">
      <h2 class="underlined">Strøm-parametere / spill av manuelt</h2>
      <div class="pure-g">
        <div class="pure-u-1-4">
          <input type="text" name="name" class="pure-input-1" value="{{.CurrentChannel}}" placeholder="Navn (valgfritt)" />
        </div>
        <div class="pure-u-1-3" style="margin-left: 10px">
          <input type="text" name="url" class="pure-input-1" value="{{.CurrentAddress}}" placeholder="URL" />
        </div>
        <div class="pure-u-1-6">
          <input type="submit" class="pure-button button-yellow set-button" value="Spill av" />
        </div>
      </div>
    </form>

    {{if .Recordings}}
    <h2 class="underlined">Planlagte opptak</h2>
    <ul>
    {{$user := .User}}
    {{range .Recordings}}
    <li><b>{{.Start}}=>{{.Stop}}</b>: <em>{{.Title}}</em> på {{ .Channel }}
    av {{ .User }} med transkoding: {{ .Transcoding }} (<a href="./stopRecording?id={{.Id}}&username={{$user}}">Stopp/slett</a>)</li>
    {{end}}
    </ul>
    {{end}}

    {{if .Subscriptions}}
    <h2 class="underlined">Dine abonnement</h2>
    <ul>
    {{range .Subscriptions}}
    <li>{{.Title}} hver {{.Weekday}} mellom {{.IntervalStart}} og {{.IntervalStop}}</li>
    {{end}}
    </ul>
    {{end}}

    <h2 class="underlined">Velg kanal</h2>
      {{$user := .User}}
      {{$transcoding := .Transcoding}}
      {{range .Channels}}
        <div class="channel">
          <a href="{{$base}}?channel={{.Name}}&transcoding={{$transcoding}}&refresh=1"><b>{{.Name}}</b></a>
          <a
            href="{{$base}}?channel={{.Name}}&transcoding={{$transcoding}}&refresh=1" class="pure-button button-green right">Spill av</a>
        </div>
        {{if not .EPGlist}}
        <p>Ingen EPG-data funnet for denne kanalen</p>
        {{else}}
        <table class="pure-table programme-list">
            {{$channel := .}}
            {{range $index, $epg := .EPGlist}}
            <tr class="{{if not $index}}header{{end}}">
              <td>
                <a href="{{$base}}record?user={{$user}}&start={{.StartLong}}&stop={{.StopLong}}&title={{.Title}}&channel={{$channel.Name}}&transcode={{$transcoding}}">R</a>
              </td>
              <td>{{.Start}}</td>
              <td>{{.Stop}}</td>
              <td>{{.Title}}</td>
            </tr>
            {{end}}
        </table>
        {{end}}
      {{end}}
      <br />
  </div>
  </body>
</html>
